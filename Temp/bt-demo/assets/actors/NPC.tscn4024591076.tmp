[gd_scene load_steps=27 format=3 uid="uid://d0vxaexplssbv"]

[ext_resource type="Script" uid="uid://dwhb6olntiigu" path="res://demos/godot-bt-demo/assets/actors/NPC.gd" id="1_mpo48"]
[ext_resource type="Texture2D" uid="uid://bsjt61unufjgi" path="res://demos/behaviour_toolkit/examples/assets/actors/tiny_village.png" id="2_t5e25"]
[ext_resource type="Script" uid="uid://d11c6gwrjou0w" path="res://addons/behaviour_toolkit/behaviour_tree/bt_root.gd" id="3_1b825"]
[ext_resource type="Resource" uid="uid://c60ird40hkxeb" path="res://demos/behaviour_toolkit/examples/behaviour_example/global_blackboard.tres" id="4_6iyjq"]
[ext_resource type="Script" uid="uid://bsjk440mp80ij" path="res://addons/behaviour_toolkit/behaviour_tree/composites/bt_simple_parallel.gd" id="5_8l46b"]
[ext_resource type="Script" uid="uid://8rcyavsdmew5" path="res://addons/behaviour_toolkit/behaviour_tree/composites/bt_selector.gd" id="6_or6n1"]
[ext_resource type="Script" uid="uid://dpr2xa1e5hy8u" path="res://addons/behaviour_toolkit/behaviour_tree/composites/bt_sequence.gd" id="7_e6p3a"]
[ext_resource type="Script" uid="uid://ddg0m2ydpvodc" path="res://demos/godot-bt-demo/assets/actors/AITasks/IfInBattle.gd" id="8_2jmv5"]
[ext_resource type="Script" uid="uid://buvb8uppbyosm" path="res://addons/behaviour_toolkit/behaviour_tree/leaves/leaf_wait.gd" id="9_xqfc3"]
[ext_resource type="Script" uid="uid://c584shlo6w6it" path="res://addons/behaviour_toolkit/behaviour_tree/bt_leaf.gd" id="10_hbmkk"]
[ext_resource type="Script" uid="uid://b211rt5modsf4" path="res://demos/godot-bt-demo/assets/actors/AITasks/DoRest.gd" id="11_ew7ra"]
[ext_resource type="Script" uid="uid://fqccyp7t47tw" path="res://demos/godot-bt-demo/assets/actors/AITasks/DoToilet.gd" id="12_75cv5"]
[ext_resource type="Script" uid="uid://ckhv8fqxpn0j3" path="res://demos/godot-bt-demo/assets/actors/AITasks/DoNothing.gd" id="13_6o4rr"]
[ext_resource type="Script" uid="uid://b0bqn8gtyevqu" path="res://addons/behaviour_toolkit/finite_state_machine/fsm.gd" id="14_wm025"]
[ext_resource type="Script" uid="uid://byn1oj8q82dky" path="res://demos/behaviour_toolkit/examples/behaviour_example/NPCs/states/state_walking.gd" id="15_1c1ov"]
[ext_resource type="Script" uid="uid://dqowalrfhfy6u" path="res://demos/behaviour_toolkit/examples/behaviour_example/NPCs/states/trans_on_stop_walking.gd" id="16_1hfbg"]
[ext_resource type="Script" uid="uid://1h0braq41vwb" path="res://addons/behaviour_toolkit/finite_state_machine/fsm_transition.gd" id="17_x3rcn"]
[ext_resource type="Script" uid="uid://dis45amsi0qtr" path="res://demos/behaviour_toolkit/examples/behaviour_example/NPCs/states/state_refreshing.gd" id="18_igce6"]
[ext_resource type="Script" uid="uid://p5w6telrj0j7" path="res://demos/behaviour_toolkit/examples/behaviour_example/NPCs/states/trans_on_start_walking.gd" id="19_6as52"]
[ext_resource type="Script" uid="uid://ctmw8rr41u1ux" path="res://demos/behaviour_toolkit/examples/behaviour_example/NPCs/states/state_idle.gd" id="20_3asj4"]

[sub_resource type="Animation" id="Animation_ndcbh"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(1, 1)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:rotation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Sprite2D:modulate")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(1, 1, 1, 1)]
}

[sub_resource type="Animation" id="Animation_q2p0v"]
resource_name = "idle"
length = 3.0
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:scale")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.8),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Vector2(1, 1), Vector2(1.1, 1.163)]
}

[sub_resource type="Animation" id="Animation_s3agd"]
resource_name = "refreshing"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:modulate")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.5),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Color(1, 1, 1, 1), Color(0.286275, 0.501961, 1, 1)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:scale")
tracks/1/interp = 2
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.2, 0.5),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector2(1, 1), Vector2(1.17, 1), Vector2(1, 1)]
}

[sub_resource type="Animation" id="Animation_bnukq"]
resource_name = "walking"
length = 0.5
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:rotation")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [-0.174533, 0.174533]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_bvcex"]
_data = {
&"RESET": SubResource("Animation_ndcbh"),
&"idle": SubResource("Animation_q2p0v"),
&"refreshing": SubResource("Animation_s3agd"),
&"walking": SubResource("Animation_bnukq")
}

[sub_resource type="CircleShape2D" id="CircleShape2D_o3jlb"]
radius = 3.0

[node name="NPC" type="CharacterBody2D" node_paths=PackedStringArray("navigation_agent", "animation_player", "state_machine", "behaviour_tree")]
texture_filter = 3
input_pickable = true
script = ExtResource("1_mpo48")
navigation_agent = NodePath("NavigationAgent2D")
animation_player = NodePath("AnimationPlayer")
state_machine = NodePath("AnimationStateMachine")
behaviour_tree = NodePath("Behaviour")

[node name="PlayerTick" type="Timer" parent="."]
autostart = true

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_bvcex")
}
playback_default_blend_time = 0.15

[node name="Sprite2D" type="Sprite2D" parent="."]
texture = ExtResource("2_t5e25")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(0, 5)
shape = SubResource("CircleShape2D_o3jlb")

[node name="NavigationAgent2D" type="NavigationAgent2D" parent="."]
path_postprocessing = 1
avoidance_enabled = true
radius = 5.0

[node name="Behaviour" type="Node" parent="." node_paths=PackedStringArray("actor")]
script = ExtResource("3_1b825")
autostart = true
actor = NodePath("..")
blackboard = ExtResource("4_6iyjq")
verbose = true

[node name="BTSimpleParallel" type="Node" parent="Behaviour"]
script = ExtResource("5_8l46b")
policy = 1

[node name="Thinking" type="Node" parent="Behaviour/BTSimpleParallel"]
script = ExtResource("6_or6n1")

[node name="Battle" type="Node" parent="Behaviour/BTSimpleParallel/Thinking"]
script = ExtResource("7_e6p3a")

[node name="IfInBattle" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/Battle"]
script = ExtResource("8_2jmv5")

[node name="BTSimpleParallel" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/Battle"]
script = ExtResource("5_8l46b")

[node name="SeeAttack" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/Battle/BTSimpleParallel"]
script = ExtResource("7_e6p3a")

[node name="LeafWait" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/Battle/BTSimpleParallel/SeeAttack"]
script = ExtResource("9_xqfc3")

[node name="DoSth" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/Battle/BTSimpleParallel/SeeAttack"]
script = ExtResource("10_hbmkk")

[node name="SeeEnemy" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/Battle/BTSimpleParallel"]
script = ExtResource("7_e6p3a")

[node name="LeafWait" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/Battle/BTSimpleParallel/SeeEnemy"]
script = ExtResource("9_xqfc3")

[node name="DoSth" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/Battle/BTSimpleParallel/SeeEnemy"]
script = ExtResource("10_hbmkk")

[node name="HomeLife" type="Node" parent="Behaviour/BTSimpleParallel/Thinking"]
script = ExtResource("7_e6p3a")

[node name="IfInHome" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife"]
script = ExtResource("10_hbmkk")

[node name="BTSelector" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife"]
script = ExtResource("6_or6n1")

[node name="IfTired" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector"]
script = ExtResource("6_or6n1")

[node name="BTSequence" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector/IfTired"]
script = ExtResource("7_e6p3a")

[node name="FindRestroom" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector/IfTired/BTSequence"]
script = ExtResource("10_hbmkk")

[node name="DoRest" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector/IfTired/BTSequence"]
script = ExtResource("11_ew7ra")

[node name="DoRest" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector/IfTired"]
script = ExtResource("11_ew7ra")

[node name="IfHungry" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector"]
script = ExtResource("7_e6p3a")

[node name="FindFood" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector/IfHungry"]
script = ExtResource("10_hbmkk")

[node name="DoEatFood" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector/IfHungry"]
script = ExtResource("10_hbmkk")

[node name="IfToilet" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector"]
script = ExtResource("6_or6n1")

[node name="BTSequence" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector/IfToilet"]
script = ExtResource("7_e6p3a")

[node name="MoveToToilet" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector/IfToilet/BTSequence"]
script = ExtResource("10_hbmkk")

[node name="DoToilet" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector/IfToilet/BTSequence"]
script = ExtResource("12_75cv5")

[node name="DoToilet" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector/IfToilet"]
script = ExtResource("12_75cv5")

[node name="IfBattle" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector"]
script = ExtResource("7_e6p3a")

[node name="IfHealthy" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector/IfBattle"]
script = ExtResource("8_2jmv5")

[node name="DoBattle" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector/IfBattle"]
script = ExtResource("8_2jmv5")

[node name="IfTraining" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector"]
script = ExtResource("7_e6p3a")

[node name="IfHealthy" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector/IfTraining"]
script = ExtResource("8_2jmv5")

[node name="DoTraining" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/HomeLife/BTSelector/IfTraining"]
script = ExtResource("8_2jmv5")

[node name="Adventure" type="Node" parent="Behaviour/BTSimpleParallel/Thinking"]
script = ExtResource("7_e6p3a")

[node name="IfHealthy" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/Adventure"]
script = ExtResource("8_2jmv5")

[node name="DoAdventure" type="Node" parent="Behaviour/BTSimpleParallel/Thinking/Adventure"]
script = ExtResource("8_2jmv5")

[node name="BTLeaf" type="Node" parent="Behaviour/BTSimpleParallel"]
script = ExtResource("13_6o4rr")

[node name="AnimationStateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state", "actor")]
script = ExtResource("14_wm025")
autostart = true
process_type = 0
initial_state = NodePath("Idle")
actor = NodePath("..")
blackboard = ExtResource("4_6iyjq")

[node name="Walking" type="Node" parent="AnimationStateMachine"]
script = ExtResource("15_1c1ov")

[node name="onStopWalking" type="Node" parent="AnimationStateMachine/Walking" node_paths=PackedStringArray("next_state")]
script = ExtResource("16_1hfbg")
next_state = NodePath("../../Idle")
event = "stop_walking"

[node name="onStartRefreshing" type="Node" parent="AnimationStateMachine/Walking" node_paths=PackedStringArray("next_state")]
script = ExtResource("17_x3rcn")
next_state = NodePath("../../Refreshing")
use_event = true
event = "start_refreshing"

[node name="Refreshing" type="Node" parent="AnimationStateMachine"]
script = ExtResource("18_igce6")

[node name="onStartWalking" type="Node" parent="AnimationStateMachine/Refreshing" node_paths=PackedStringArray("next_state")]
script = ExtResource("19_6as52")
next_state = NodePath("../../Walking")
use_event = true
event = "start_walking"

[node name="onStartIdle" type="Node" parent="AnimationStateMachine/Refreshing" node_paths=PackedStringArray("next_state")]
script = ExtResource("19_6as52")
next_state = NodePath("../../Idle")
use_event = true
event = "start_idle"

[node name="Idle" type="Node" parent="AnimationStateMachine"]
script = ExtResource("20_3asj4")

[node name="onStartWalking" type="Node" parent="AnimationStateMachine/Idle" node_paths=PackedStringArray("next_state")]
script = ExtResource("19_6as52")
next_state = NodePath("../../Walking")
use_event = true
event = "start_walking"

[node name="onStartRefreshing" type="Node" parent="AnimationStateMachine/Idle" node_paths=PackedStringArray("next_state")]
script = ExtResource("17_x3rcn")
next_state = NodePath("../../Refreshing")
use_event = true
event = "start_refreshing"

[connection signal="input_event" from="." to="." method="_on_input_event"]
[connection signal="timeout" from="PlayerTick" to="." method="_on_player_tick_timeout"]
